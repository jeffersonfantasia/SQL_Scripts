CREATE OR REPLACE VIEW VIEW_JC_LANC_GERENCIAL AS
    SELECT L.CODFILIAL,
           L.RECNUM,
           L.DTCOMPETENCIA AS DATA,
           L.VALOR,
           L.CODCONTA,
           (
               CASE
                   WHEN (L.NUMNOTA IS NULL
                       OR L.NUMNOTA = 0) THEN L.HISTORICO
                   ELSE ('NFS ' || L.NUMNOTA || ' - ' || L.HISTORICO)
               END
           ) AS HISTORICO,
           C.CONTACONTABIL AS CONTACREDITO
      FROM PCLANC L
      LEFT JOIN PCCONTA C ON L.CODCONTA = C.CODCONTA
     WHERE L.DTCANCEL IS NULL
     /*NAO CONSIDERAR LANCAMENTOS CANCELADOS*/
       AND L.DTESTORNOBAIXA IS NULL
     /*NAO CONSIDERAR LANCAMENTOS ESTORNADOS  */
       AND (L.TIPOLANC = 'C'
        OR L.DTPAGTO IS NOT NULL)
     /*SOMENTE LANÇAMENTOS CONFIRMADOS OU PAGOS*/
       AND L.CODCONTA IN (
        810101, 810102, 810103
    );
/